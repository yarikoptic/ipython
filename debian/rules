#!/usr/bin/make -f
# ipython debian/rules file
DEB_PYTHON_SYSTEM = pysupport
PYVERS = $(shell pyversions -sv)
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/python-distutils.mk
include /usr/share/cdbs/1/rules/dpatch.mk

install/ipython::
	# remove documentation
	rm $(CURDIR)/debian/ipython/usr/share/doc/ipython/COPYING
	rm $(CURDIR)/debian/ipython/usr/share/doc/ipython/ChangeLog
	rm $(CURDIR)/debian/ipython/usr/share/doc/ipython/README_Windows.txt
	rm $(CURDIR)/debian/ipython/usr/share/doc/ipython/pycon.ico

	install -m 755 debian/ipython.sh $(CURDIR)/debian/ipython/usr/bin/ipython
	# add wrapper scripts for all python versions
	set -e ;\
	for pyvers in $(PYVERS); do \
	    dh_link /usr/bin/ipython /usr/bin/ipython$$pyvers;\
	    dh_link /usr/share/man/man1/ipython.1.gz /usr/share/man/man1/ipython$$pyvers.1.gz; \
	done

	# change permission on scripts
	chmod a-x $(CURDIR)/debian/ipython/usr/share/doc/ipython/examples/*
	
	# removing bogus usr/IPython directory
	rm -rf $(CURDIR)/debian/ipython/usr/IPython

binary-fixup/ipython::
	# fix lintian warnings (see also patches/04_remove_shebang.dpatch)
	chmod +x $(CURDIR)/debian/ipython/usr/share/python-support/ipython/IPython/upgrade_dir.py
	chmod +x $(CURDIR)/debian/ipython/usr/share/python-support/ipython/IPython/Extensions/pickleshare.py
	chmod +x $(CURDIR)/debian/ipython/usr/share/python-support/ipython/IPython/irunner.py
	chmod +x $(CURDIR)/debian/ipython/usr/share/python-support/ipython/IPython/external/mglob.py

get-orig-source:
	uscan --verbose --rename --repack
